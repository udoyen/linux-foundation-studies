
		/*
 * Copyright (C) 2007 Trivantis Corporation
 */

	
var jTitleManager=new JSTitleMgr();var TR_SHOWALL_QUESTIONS=(0x1|0x2|0x4);ID_RESULT_TEST_TESTNAME=1;ID_RESULT_TEST_SECTNAME=2;ID_RESULT_TEST_SUTDENTNAME=3;ID_RESULT_TEST_PASSSTATUS=4;ID_RESULT_TEST_FAILSTATUS=5;ID_RESULT_TEST_TESTSCORE=6;ID_RESULT_TEST_CORRECTOVTOTAL=7;ID_RESULT_TEST_PASSSCORE=8;ID_RESULT_TEST_ELAPSEDTIME=9;ID_RESULT_TEST_DATETIME=10;ID_RESULT_TEST_CUSTOMTEXT=11;ID_RESULT_TEST_CUSTOMIMAGE=12;ID_RESULT_TEST_QUESTPLACEHOLD=13;ID_RESULT_QUEST_NUMBER=1;ID_RESULT_QUEST_NAME=2;ID_RESULT_QUEST_TEXT=3;ID_RESULT_QUEST_STUANSWER=4;ID_RESULT_QUEST_CORRANSWER=5;ID_RESULT_QUEST_STATUSTEXT=6;ID_RESULT_QUEST_STATUSIMAGE=7;ID_RESULT_QUEST_ANSWERCHOICES=8;ID_RESULT_QUEST_TEXTFB=9;ID_RESULT_QUEST_NUMATTEMPTS=10;ID_RESULT_QUEST_MAXATTEMPTS=11;ID_RESULT_QUEST_LINKBACK=12;ID_RESULT_QUEST_LINKPAGE1=13;function JSTitleMgr(){var A=this;A.arVars=[];A.arTests=[];A.bPerUpd=false;A.bIntActs=false;A.bIncludeQuestionText=false;A.bForceTF=true;A.bSCORM=false;A.bAICC=false;A.bTinCan=false;A.intCID=-1;A.intLID=-1;A.intSID=-1;A.intTIdx=-1;A.intQIdx=-1;A.cmVers=0;A.scVers=0;A.strAiccST='';A.strAiccEM='';A.strAiccSN='';A.strAiccCR='';A.strAiccCO='';A.strCmBase='';A.strRedir='';};var TMPr=JSTitleMgr.prototype;TMPr.setCoursemillParms=function(A,B,C,D){var E=this;E.strAiccST=''+A;E.strAiccSN=''+B;E.strAiccCO=''+C;E.strCmBase=''+D;};TMPr.setUserInfo=function(A,B){this.strAiccSN=A;this.strAiccEM=B;};TMPr.findVariable=function(A){var i;var B=A.toLowerCase();for(i=0;i<this.arVars.length;i++){var C=this.arVars[i].vn.toLowerCase();if(C==B) return i;};return-1;};TMPr.getVariable=function(A,B,C){var i=this.findVariable(A);if(i>=0) return this.arVars[i].vv;return this.addVariable(A,B,C);};TMPr.setVariable=function(A,B,C){var D=this;var i=D.findVariable(A);if(D.intTIdx!=-1) D.arTests[D.intTIdx].SetInteraction(A,D.intQIdx);if(i>=0){if(D.arVars[i].bP&&D.arVars[i].vv!=B) D.bPerUpd=true;D.arVars[i].vv=B;if(A=='cmi.core.student_name') D.strAiccSN=B;return;};D.addVariable(A,B,C);};TMPr.addVariable=function(A,B,C){if(B==null) B="";var D=new TrivVar();D.vn=A;D.vv=B;if(C){D.bP=true;this.bPerUpd=true;};this.arVars.push(D);if(A=='cmi.core.student_name') this.strAiccSN=B;return B;};TMPr.loadTest=function(A,B,C){var D=this,E=D.getTIdx(B,1);if(E<0) return false;if(!D.arTests[E].bLoaded){var F=getHTTP(A+'.txt','GET',null);if(F.status!=200&&F.status!=0){trivAlert('LOADTESTERR',B,getLocStr(trivstrErrLoadTestServer,F.status,F.statusText));return;};var G=Base64.decode(F.responseText);if (G!=null){if (window.DOMParser){var H=new DOMParser();var I=H.parseFromString(G,"application/xml");nl=I.documentElement;}else if (window.ActiveXObject){I=new ActiveXObject("Microsoft.XMLDOM");I.async=false;I.loadXML(G);nl=I.documentElement;}};if (nl){nl.normalize();}else{trivAlert('LOADTESTERR',tn,'You must run this content from a web-based server');return;};D.arTests[E].strLoadedName=B;D.arTests[E].loadTestFile(nl);};D.intTIdx=-1;if(D.arTests[E].bLoaded&&D.bIntActs){D.intQIdx=D.arTests[E].StartInteractions(C);if(D.intQIdx!=-1) D.intTIdx=E;};return true;};TMPr.ResetTest=function(A){var B=this.getTIdx(A,true);if(B<0) return false;this.arTests[B].ResetTest();return true;};TMPr.getTIdx=function(A,B){var i;for(i=0;i<this.arTests.length;i++){if(this.arTests[i].strLoadedName==A) return i;};if(!B) return-1;var C=new TrivTest();this.arTests.push(C);return this.arTests.length-1;};TMPr.getRemainingTime=function(A){var B=this.getTIdx(A,false);var C=0;var D=0;if(B<0||!this.arTests[B].bLoaded) return null;if(this.arTests[B].lStartTime>0){var E=new Date().getTime();D=E-this.arTests[B].lStartTime;};C=parseInt((this.arTests[B].iTestTime*60000-D-this.arTests[B].lElapsedTime)/1000,10);if(C>0){var F;var G=parseInt(C/3600,10);C-=G*3600;F=G+':';G=parseInt(C/60,10);C-=G*60;if(G<=9) F+='0';F+=G+':';if(C<=9) F+='0';F+=C;return F;}else return null;};TMPr.startTestTimer=function(A){var B=this.getTIdx(A,false);if(B<0||!this.arTests[B].bLoaded) return;if(this.arTests[B].lStartTime==0) this.arTests[B].lStartTime=new Date().getTime();};TMPr.stopTestTimer=function(A){var B=this.getTIdx(A,false);if(B<0||!this.arTests[B].bLoaded) return;if(this.arTests[B].lStartTime>0){var C=new Date();this.arTests[B].lElapsedTime+=C.getTime()-this.arTests[B].lStartTime;this.arTests[B].lStartTime=0;}};TMPr.getRandomPageNumber=function(A,B){var C=this.getTIdx(A,false);if(C<0||!this.arTests[C].bLoaded) return "";return this.arTests[C].getRandomPageNumber(B);};TMPr.getRandomSectPageNumber=function(A,B,C){var D=this.getTIdx(A,false);if(D<0||!this.arTests[D].bLoaded) return "";return this.arTests[D].getRandomSectPageNumber(B,C);};TMPr.getPrevTestPage=function(A,B){var C=this.getTIdx(A,false);if(C<0||!this.arTests[C].bLoaded) return null;var D=this.arTests[C].getPrevTestPage(B);if(D!=null){if(D.indexOf('#')==0){var E=D.substring(1);C=this.getTIdx(E,false);if(C>=0&&this.arTests[C].bLoaded){var F=this.arTests[C].iNumPages-1;D=this.arTests[C].arRTPages[F].name;}};return D;}else return this.processTest(A);};TMPr.getNextTestPage=function(A,B){var C=this.getTIdx(A,false);if(C<0||!this.arTests[C].bLoaded) return null;var D=this.arTests[C].getNextTestPage(B);if(D!=null){if(D.indexOf('#')==0){var E=D.substring(1);D=this.getNextTestPage(E,"");};return D;}else return null;};TMPr.getRandomPage=function(A,B){var C=this.getTIdx(A,false);if(C<0||!this.arTests[C].bLoaded) return null;return this.arTests[C].getRandomPage(B);};TMPr.cancelTest=function(A){var B=this.getTIdx(A,false);if(B<0||!this.arTests[B].bLoaded) return null;var C=this.arTests[B].strFailPage;if(C.indexOf('#')==0){var D=C.substring(1);C=this.getNextTestPage(D,"");};return C;};TMPr.processTest=function(A){var B=this;var C=B.getTIdx(A,false);var D=B.arTests[C];if(C<0||!D.bLoaded) return null;strTestName=D.strTestName;D.GradeTest(B.arVars);D.strTestResult=D.ProcessTest(B.strCmBase,B.strAiccSN,B.strAiccST,B.strAiccEM,B.strAiccCO,B.arVars);if(D.strTestResult.indexOf('#')==0){var E=D.strTestResult.substring(1);D.strTestResult=B.getNextTestPage(E,"");};if(B.bIntActs){var F;var G;var H;if(B.bSCORM){if(B.intCID==-1) B.intCID=B.findVariable("cmi.core.course_id");if(B.intLID==-1) B.intLID=B.findVariable("cmi.core.lesson_id");if(B.intSID==-1) B.intSID=B.findVariable("cmi.core.student_id");}else{if(B.intCID==-1) B.intCID=B.findVariable("COURSE_ID");if(B.intLID==-1) B.intLID=B.findVariable("LESSON_ID");if(B.intSID==-1) B.intSID=B.findVariable("STUDENT_ID");};if(B.intCID!=-1) F=B.arVars[B.intCID].vv;else F=B.strAiccCO;if(B.intLID!=-1) G=B.arVars[B.intLID].vv;else G="";if(B.intSID!=-1) H=B.arVars[B.intSID].vv;else H="";var I=new TrivStr("");D.HandleInteractions(I,F,H,G,B.scVers,B.bIncludeQuestionText,B.bForceTF);if(B.bAICC) B.PutInteractions(I.str);};return D.strTestResult;};TMPr.getStudentResults=function(A){var i=this.getTIdx(A,false);return ((i<0||!this.arTests[i].bLoaded)?null:this.arTests[i].strStudentRes);};TMPr.getTestName=function(A){var i=this.getTIdx(A,false);return ((i<0||!this.arTests[i].bLoaded)?null:this.arTests[i].strTestName);};TMPr.getProcessTestResult=function(A){var i=this.getTIdx(A,false);return ((i<0||!this.arTests[i].bLoaded)?null:this.arTests[i].strTestResult);};TMPr.getProcessTestResponse=function(A){var B=this.getTIdx(A,false);if(B<0||!this.arTests[B].bLoaded) return null;return this.arTests[B].strTestSubmit;};TMPr.GetTestScore=function(A){var i=this.getTIdx(A,false);if(i<0) return "0";var B=this.arTests[i];if(!B.bLoaded) return "0";B.iQuestCnt=0;B.iCorrCnt=0;var C=B.GradeTest(this.arVars);if(!B.bAutoG||C>=B.iPassGrade||C==-1) B.strTestResult=B.strPassPage;else B.strTestResult=B.strFailPage;return C;};TMPr.GetIfTestPassed=function(A){var B=this.getTIdx(A,false);if(B<0||!this.arTests[B].bLoaded) return false;var C=this.arTests[B].GradeTest(this.arVars);if(!this.arTests[B].bAutoG||C>=this.arTests[B].iPassGrade||C==-1) return true;else return false;};TMPr.GetQuestionList=function(A){var B=this.getTIdx(A,false);if(B<0||!this.arTests[B].bLoaded) return "0";return this.arTests[B].getQuestionList();};TMPr.GetTestSectionScore=function(A,B){var C=this.getTIdx(A,false);if(C<0||!this.arTests[C].bLoaded) return "0";return this.arTests[C].GradeTestSection(this.arVars,B);};TMPr.getVariableNameAt=function(A){if(A>=0&&A<this.arVars.length) return this.arVars[A].vn;return "";};TMPr.getVariableValueAt=function (A){if(A>=0&&A<this.arVars.length) return this.arVars[A].vv;return "";};TMPr.getNumVariables=function(){return this.arVars.length;};TMPr.isWeb20Enabled=function(){return trivWeb20Popups;};function TrivBase(){};TrivBase.prototype.getLoadedTest=function(){var A=this;while (A){if (A.strLoadedName) return A;A=A.par;};return n;};function TrivVar(){this.bP=false;this.vn="";this.vv="";};function TrivStr(a){this.str=a;this.count=0;};p=TrivStr.prototype;p.add=function(a){this.str+=a;};p.getCount=function(){return this.count++;};p.addparm=function(A,B,C){if(this.str.length>0) this.str+="&";if(C) this.str+=A+"="+B;else this.str+=escape(A)+"="+escape(B);};function navtoPage(A,B){var C=window['wndPage'];if (C&&C.navtoPage) C.navtoPage(B);else trivExitPage(A);};function getNVStr(A,B,C){var D=A.getElementsByTagName(B)[0];if(D&&D.firstChild) return D.firstChild.data;else return C;};function getNVInt(A,B,C){if (!A) return C;var D=parseInt(getNVStr(A,B,C),10);return (isNaN(D)?C:D);};function get_random(A){var B=0;A+=2;while (B<1||B>A-1) B=Math.round(Math.random()*A);return (B-1);};function TrivTest(){var A=this;A.bLoaded=false;A.strLoadedName="";A.strTestName="";A.strResults="";A.bAutoG=0;A.iShowRes=0;A.bShowScOnly=0;A.iTestTime=0;A.iNumberRandom=0;A.iPassGrade=0;A.bModeGet=0;A.bIncVar=0;A.bPromptSuc=0;A.bPersist=0;A.iStudScore=0;A.lStartTime=0;A.lElapsedTime=0;A.strFailPage="";A.strPassPage="";A.strPrevPage="";A.strAllowedTM="";A.strElapsedTM="";A.strTestSubmit="";A.bSurvey=0;A.arRTPages=[];A.strStudentRes="";A.bGDocs=0;A.bIsNewGDocURL=false;A.iQuestCnt=0;A.iCorrCnt=0;A.settingsTest=n;A.settingsQCorr=n;A.settingsQIncorr=n;A.settingsQUnans=n;};TrivTest.prototype=new TrivBase();TrivTest.prototype.constructor=TrivBase;var TTPr=TrivTest.prototype;TTPr.loadTestFile=function(A){var B=this;B.bSurvey=getNVInt(A,'survey',B.bSurvey);B.bAutoG=getNVInt(A,'grade',B.bAutoG);B.bShowRes=getNVInt(A,'showresults',B.bShowRes);B.bShowScOnly=getNVInt(A,'scoreonly',B.bShowScOnly);B.bModeGet=getNVInt(A,'get',B.bModeGet);B.bIncVar=getNVInt(A,'incvar',B.bIncVar);B.bPromptSuc=getNVInt(A,'promptsuccess',B.bPromptSuc);B.bPersist=getNVInt(A,'persist',B.bPersist);B.strTestName=getNVStr(A,'name',B.strTestName);B.strResults=getNVStr(A,'submitto',B.strResults);B.iTestTime=getNVInt(A,'testtime',B.iTestTime);B.iNumberRandom=getNVInt(A,'numrandom',B.iNumberRandom);B.iPassGrade=getNVInt(A,'passinggrade',B.iPassGrade);B.strFailPage=getNVStr(A,'cancelfail',B.strFailPage);B.strPassPage=getNVStr(A,'passdone',B.strPassPage);B.strPrevPage=getNVStr(A,'prevpage',B.strPrevPage);B.bGDocs=getNVInt(A,'gdocs',B.bGDocs);B.testNode=A;B.LoadPages();B.bLoaded=true;};TTPr.LoadPages=function(){var A=this,B,C,D=[],E=A.testNode;var F=function (K,L){for (var i=0;i<K.length;i++) if (K[i].id==L) return K[i];};if (E.childNodes&&E.childNodes.length) for (var i=0;i<E.childNodes.length;i++){var G=E.childNodes[i],H=G.tagName?G.tagName.toLowerCase():'none';if (H=='page'){B=new TrivTestPage();B.load(-1,G);B.par=A;if (!B.bResults) D.push(B);}else if (H=='section'){C=new TrivTestSection();C.load(G);C.par=A;C.LoadPages(D,(A.iNumberRandom>0)?false:true);}};if (A.iNumberRandom>0){if (A.arRandomPgIds!=u){for (var i=0;i<A.arRandomPgIds.length;i++){var I=F (D,A.arRandomPgIds[i]);if (I) A.arRTPages.push(I);}}else{if (A.iNumberRandom>D.length) A.iNumberRandom=D.length;while (A.iNumberRandom>A.arRTPages.length){var J=get_random(D.length-1);A.arRTPages.push(D.splice(J,1)[0]);}}}else A.arRTPages=D;};TTPr.ResetTest=function(){this.arRTPages.length=0;this.LoadPages();this.lElapsedTime=0;};TTPr.GetTestScore=function(A){var B=0;var C=0;var D=0;var E=0;var F=true;for(var G=0;G<this.arRTPages.length;G++){this.arRTPages[G].gradeQs(A);if(!this.arRTPages[G].isScoreable()) F=false;D=this.arRTPages[G].getMaxScore();E=this.arRTPages[G].getScore();B+=D;C+=E;};if(F){if(B>0) this.iStudScore=parseInt(C*100.0/B+0.5,10);else this.iStudScore=100;}else this.iStudScore=-1;return this.iStudScore;};TTPr.getQuestionList=function(){var A='';for(var B=0;B<this.arRTPages.length;B++){var C=this.arRTPages[B].getQuestionList();if(C.length!=0) A+=C;};return A;};TTPr.GradeTest=function(A) { return this.GetTestScore(A);};TTPr.GradeTestSection=function(A,B){var C=0;var D=0;var E=0;var F=0;var G=0;var H=true;for(var I=0;I<this.arRTPages.length;I++){if(this.arRTPages[I].iSectionId==B){this.arRTPages[I].gradeQs(A);if(!this.arRTPages[I].isScoreable()) H=false;E=this.arRTPages[I].getMaxScore();F=this.arRTPages[I].getScore();C+=E;D+=F;}};if(H){if(C>0) G=parseInt(D*100/C,10);else G=100;}else G=-1;return G;};TTPr.ProcessTest=function(A,B,C,D,E,F){var G=this;var H=null;var I=true;var J,K,L,M;if(G.iTestTime>0){J=G.iTestTime*60;K=parseInt(J/3600,10);J-=(K*3600);G.strAllowedTM="";if(K<10) G.strAllowedTM+="0";G.strAllowedTM+=K+":";K=parseInt(J/60,10);J-=(K*60);if(K<10) G.strAllowedTM+="0";G.strAllowedTM+=K+":";if(J<10) G.strAllowedTM+="0";G.strAllowedTM+=J;L=parseInt(G.lElapsedTime/1000,10);if(L>G.iTestTime*60||L<0) L=G.iTestTime*60;K=parseInt(L/3600,10);L=L-(K*3600);G.strElapsedTM="";if(K<10) G.strElapsedTM+="0";G.strElapsedTM+=K+":";K=parseInt(L/60,10);L-=(K*60);if(K<10) G.strElapsedTM+="0";G.strElapsedTM+=K+":";if(L<10) G.strElapsedTM+="0";G.strElapsedTM+=L;};window.resWind=null;if (G.bShowRes){G.strStudentRes=G.CreateTextResults(B,F);};H=G.getVariableMacroValue(G.strResults,F);G.bIsNewGDocURL=G.bGDocs&&parseKeyFromGDocURL(H)==n;if(I&&H&&H.toLowerCase()!="null"&&H.length>0){M=new TrivStr("");if(G.bGDocs){if (B) if (G.bIsNewGDocURL) M.addparm('entry_1'+padDigits(M.getCount(),6),B);else{var N=parseKeyFromGDocURL(G.strResults);if (N) M.addparm(N[0],N[1]);M.addparm('entry.'+M.getCount()+'.single',B);}}else M.addparm("name",B);G.CreateCGIResults(M,F);M.str=M.str.replace(/\+/g,'%2B');var O=null;if (G.bGDocs){H=G.bIsNewGDocURL?H:"https://spreadsheets.google.com/formResponse";if(is.ie&&!G.bIsNewGDocURL){var P=H+'?'+M.str;var Q=document.getElementsByTagName("head").item(0);var R=document.createElement("script");R.setAttribute("type","text/javascript");R.setAttribute("src",P);Q.appendChild(R);}else O=getHTTP(H,(G.bIsNewGDocURL?'POST':'GET'),M.str);I=true;}else{O=getHTTP(H,'POST',M.str);I=(O.status==200);G.strTestSubmit=O.responseText;};if(I&&G.bPromptSuc){var S=(!G.bSurvey?trivstrTRSUB:trivstrSUSUB);if(!trivWeb20Popups||true){if(window.resWind!=null) window.resWind.alert(S);else alert(S);}else trivAlert('SUBERR',G.strLoadedName,S);}};if(!G.bAutoG||G.iStudScore>=G.iPassGrade||G.iStudScore==-1) return G.strPassPage;else return G.strFailPage;};TTPr.CreateTextResults=function(A,B){var C=this,D,E=0,F=new TrivStr(""),G=C.settingsTest;var H=function (K){return  K.charAt(K.length-1)==" "?K:K+=" ";};var I=function(L,M,N,O){var P='style="'+(O?O:''),Q=M?M.font:n;Q=Q||C.defaultFont;P+='margin:'+(Q&&Q.size?Math.round(Q.size/2):8)+'px 0px;';if (Q){if (Q.name) 		P+='font-family:'+Q.name+';';if (Q.size) 		P+='font-size:'+Q.size+'pt;';if (Q.bold) 		P+='font-weight:bold;';if (Q.italic) 		P+='font-style:italic;';if (Q.underline) 	P+='text-decoration:underline;';if (Q.color)	 	P+='color:'+Q.color+';';};P+='"';F.add('<p '+(P?P:'')+'>'+L+'</p>');};var J=function(R){if (R&&R.res){var S=R.res.size,T='',U;if (S) T=' width="'+S.x+'" height ="'+S.y+'"';U=(typeof R.res.getLink=='function')?R.res.getLink():R.res.linkName;F.add('<img style="margin:5px 0px;" src="'+U+'"'+T+'>');}};if (G) trivArExec(G.arRsltItems,function(W){switch(W.id){case 4:I(C.strTestName,W);break;case 2:if(C.bEditMode||C.iStudScore!=-1&&C.bAutoG&&C.iStudScore>=C.iPassGrade) I(trivstrPASS,W);break;case 3:if(C.bEditMode||C.iStudScore!=-1&&C.bAutoG&&C.iStudScore<C.iPassGrade) I(trivstrFAIL,W);break;case 5:if(A!=null&&A.length>0) I(H(trivstrSTUD)+A,W);break;case 1:if(C.iStudScore!=-1&&C.bAutoG) I(H(trivstrSCORE)+C.iStudScore+"%",W);break;case 7:I(H(trivstrCOVT)+C.iCorrCnt+' / '+C.iQuestCnt,W);break;case 8:if (C.iPassGrade) I(H(trivstrPSCO)+C.iPassGrade,W);break;case 12:J(W);break;case 13:for(D=0;D<C.arRTPages.length;D++) E=C.arRTPages[D].createTextResults(F,E,C.bAutoG);break;}});return F.str;};TTPr.CreateCGIResults=function(A,B,C){var D=this;var E;var F=0;var G=-1;var H=0;var I=0;var J=0;var K=0;var L=0;var M=0;var N=0;var O=0;var P=0;var Q=0;var R=0;var S=0;if(C==undefined) C=D.bGDocs;if(!C) A.addparm(D.bSurvey?"SurveyName":"TestName",D.strTestName);for(E=0;E<D.arRTPages.length;E++){F=D.arRTPages[E].createCGIResults(A,F,C,D.bIsNewGDocURL);if(G!=D.arRTPages[E].iSectionId){if(G>0&&D.bAutoG){var T="TrueFalseSection"+G;var U=O+"/"+I;if(!C) A.addparm(T,U);T="MultipleChoiceSection"+G;U=R+"/"+L;if(!C) A.addparm(T,U);};O=0;R=0;I=0;L=0;G=D.arRTPages[E].iSectionId;};J=D.arRTPages[E].getNumTFQs();P=D.arRTPages[E].getNumCorrectTFQs();M=D.arRTPages[E].getNumMCQs();S=D.arRTPages[E].getNumCorrectMCQs();H+=J;I+=J;N+=P;O+=P;K+=M;L+=M;Q+=S;R+=S;};if(!D.bShowScOnly&&G>0&&D.bAutoG){var T="TrueFalseSection"+G;var U=O+"/"+I;if(!C) A.addparm(T,U);T="MultipleChoiceSection"+G;U=R+"/"+L;if(!C) A.addparm(T,U);};if(D.iStudScore!=-1&&D.bAutoG){if(C) if (D.bIsNewGDocURL) A.addparm('entry_1'+padDigits(A.getCount(),6),D.iStudScore);else A.addparm('entry.'+A.getCount()+'.single',D.iStudScore);else A.addparm("Score",D.iStudScore);};if(D.bAutoG){if(!C) A.addparm("PassingGrade",D.iPassGrade);if(!C) A.addparm("TrueFalse",N+"/"+H);if(!C) A.addparm("MultipleChoice",Q+"/"+K);};A.addparm("NumQuestions",F);if(D.strAllowedTM!=""){if(!C) A.addparm("AllowedTime",D.strAllowedTM);if(!C) A.addparm("ElapsedTestTime",D.strElapsedTM);};if(D.bIncVar&&!C){for(E=0;E<B.length;E++) {if ((submitValue=D.getVariableSubmitValue(E,B))=="~~~null~~~") submitValue=trivstrNA;A.addparm(D.getVariableSubmitName(E,B),submitValue,true);}};return true;};TTPr.getRandomPageNumber=function(A){var i;for(i=0;i<this.arRTPages.length;i++) if(this.arRTPages[i]&&this.arRTPages[i].name==A) return String(i+1);return "";};TTPr.getRandomSectPageNumber=function(A,B){var i;var C=0;for(i=0;i<this.arRTPages.length;i++){if(this.arRTPages[i].iSectionId==A) C++;if(this.arRTPages[i].name==B) return String(C);};return "";};TTPr.findTestPage=function(A){var i;for(i=0;i<this.arRTPages.length;i++) if(this.arRTPages[i].name==A) return i;return-1;};TTPr.getPrevTestPage=function(A){var B=this.findTestPage(A);if(B>0) B--;else if(B==0) return this.strPrevPage;else B=this.arRTPages.length-1;if(B>=0&&B<this.arRTPages.length) return this.arRTPages[B].name;return null;};TTPr.getNextTestPage=function(A){var B=this.findTestPage(A);if(B>-1&&B<this.arRTPages.length) B++;else B=0;if(B>=0&&B<this.arRTPages.length) return this.arRTPages[B].name;return null;};TTPr.getRandomPage=function(A){var i;var B=0;if(A) B=A.length;for(i=0;i<this.arRTPages.length;i++){var C=this.arRTPages[i].name.substr(0,B);if(C==A) return this.arRTPages[i].name;};return null;};TTPr.getVariableSubmitName=function(A,B){if(B[A].vn.length>3){var C=B[A].vn.substring(0,3).toLowerCase();if(C=="var") return B[A].vn.substring(3);};return B[A].vn;};TTPr.getVariableSubmitValue=function(A,B){if(B[A].vv.length>7){var C=B[A].vv.substring(0,7);if(C=="~~f=1~~"||C=="~~f=2~~"||C=="~~f=4~~"){var D=B[A].vv.indexOf('|');return B[A].vv.substring(D+1);}}else if (B[A].vv=="~~~null~~~") return "";return B[A].vv;};TTPr.getVariableMacroValue=function(A,B){var C=A;var D=A.length;if(D>6){var E;var F;var G;E=A.substring(0,4).toLowerCase();F=A.substring(4,D-1);G=A.substring(D-1);if(E=="var("&&G==")"){var H;for(H=0;H<B.length;H++){if(B[H].vn==F) return this.getVariableSubmitValue(H,B);}}};return C;};function TrivTestSection(){var A=this;A.iNumberRandom=0;A.iSectionId=-1;A.index=-1;A.arPages=[];A.par=n;};TrivTestSection.prototype=new TrivBase();TrivTestSection.prototype.constructor=TrivBase;var TSPr=TrivTestSection.prototype;TSPr.load=function(A){this.iSectionId=getNVInt(A,'id',this.iSectionId);this.iNumberRandom=getNVInt(A,'numrandom',this.iNumberRandom);this.index=getNVInt(A,'index',this.index);var B=A.getElementsByTagName('page');if (B) for(var i=0;i<B.length;i++){var C=new TrivTestPage();C.load(this.iSectionId,B[i]);C.par=this;this.arPages.push(C);}};TSPr.LoadPages=function(A,B){var C=this,D=[],i,E;if(C.iNumberRandom>0&&B){for(i=0;i<C.arPages.length;i++) D.push(C.arPages[i]);if (C.iNumberRandom>D.length) C.iNumberRandom=D.length;E=D.length;while (E-D.length<C.iNumberRandom){var F=get_random(D.length-1);A.push(D.splice(F,1)[0]);}}else{for(i=0;i<C.arPages.length;i++) A.push(C.arPages[i]);}};function TrivTestPage(){var A=this;A.index=-1;A.name="";A.iSectionId=-1;A.arQues=[];A.par=n;A.id=n;};TrivTestPage.prototype=new TrivBase();TrivTestPage.prototype.constructor=TrivBase;var TPPr=TrivTestPage.prototype;TPPr.load=function(A,B){var C=this;C.iSectionId=A;C.index=getNVInt(B,'index',C.index);C.name=getNVStr(B,'name',C.name);C.bResults=getNVInt(B,'testresults',C.bResults);C.id=getNVInt(B,'id',C.id);var D=B.getElementsByTagName('question');if (D) for(var i=0;i<D.length;i++){var E=new TrivQuestion();E.load(C.iSectionId,D[i]);E.par=C;C.arQues.push(E);}};TPPr.gradeQs=function(A){for(var B=0;B<this.arQues.length;B++) this.arQues[B].gradeQs(A);};TPPr.getQuestionList=function(){var A=this;var B='';for(var C=0;C<A.arQues.length;C++){if((A.arQues[C].type==7||A.arQues[C].type==6)&&A.arQues[C].bGradeInd){var D;for(D=0;D<A.arQues[C].arCorrAns.length;D++) B+=A.arQues[C].id+'-'+(D+1)+';';}else if((A.arQues[C].type==2||A.arQues[C].type==14||A.arQues[C].type==9||A.arQues[C].type==11)&&A.arQues[C].bGradeInd){var D;for(D=0;D<A.arQues[C].arChoices.length;D++) B+=A.arQues[C].id+'-'+(D+1)+';';}else B+=A.arQues[C].id+';';};return B;};TPPr.getNumTFQs=function(){var A=0;for(var B=0;B<this.arQues.length;B++) A+=this.arQues[B].getNumTFQs();return A;};TPPr.getNumCorrectTFQs=function(){var A;var B=0;for(A=0;A<this.arQues.length;A++) B+=this.arQues[A].getNumCorrectTFQs();return B;};TPPr.getNumMCQs=function(){var A;var B=0;for(A=0;A<this.arQues.length;A++) B+=this.arQues[A].getNumMCQs();return B;};TPPr.getNumCorrectMCQs=function(){var A;var B=0;for(A=0;A<this.arQues.length;A++) B+=this.arQues[A].getNumCorrectMCQs();return B;};TPPr.createTextResults=function(A,B,C){var D=this,E=D.getLoadedTest();for(var F=0;F<D.arQues.length;F++){var G=D.arQues[F],H=G.isCorrect(),I=f,J=f,K=f;I=H>0;J=(G.bGradeInd?H<G.arChoices.length:H==0);K=!G.isAnswered();if (!G.bGradeInd&&K) J=f;if ((E.dwTRFlags&0x1&&I)||(E.dwTRFlags&0x2&&J)||(E.dwTRFlags&0x4&&K)){B=G.createTextResults(A,B,C);}};return B;};TPPr.getMaxScore=function(){var A=0;for(var B=0;B<this.arQues.length;B++) A+=this.arQues[B].getMaxScore();return A;};TPPr.getScore=function(){var A=0;for(var B=0;B<this.arQues.length;B++) A+=this.arQues[B].getScore();return A;};TPPr.isScoreable=function(){for(var A=0;A<this.arQues.length;A++) if(!this.arQues[A].isScoreable()) return false;return true;};TPPr.createCGIResults=function(A,B,C,D){for(var E=0;E<this.arQues.length;E++) B=this.arQues[E].createCGIResults(A,B,C,D);return B;};function TrivQuestion(){var A=this;A.id=0;A.iSectionId=-1;A.type=0;A.weight=1;A.name="";A.varName="";A.text="";A.corrAns="";A.arCorrAns=[];A.arChoices=[];A.arChoiceFBs=[];A.arAddedInfo=[];A.arRel=[];A.arStatements=[];A.choices="";A.bAllowMult=0;A.bPersist=0;A.bGradeInd=0;A.bSurvey=0;A.strOurAns="";A.iOurScore=0;A.par=n;};TrivQuestion.prototype=new TrivBase();TrivQuestion.prototype.constructor=TrivBase;var TQPr=TrivQuestion.prototype;TrivQuestion.arGrIndMasterItems=[101,106,102,109,105,113];TQPr.load=function(A,B){var C=this,D;C.iSectionId=A;C.id=getNVInt(B,'id',C.id);C.type=getNVInt(B,'type',C.type);C.weight=getNVInt(B,'weight',C.weight);C.name=getNVStr(B,'name',C.name);C.varName=getNVStr(B,'var',C.varName);D=getNVStr(B,'text',C.text);C.corrAns=unescape(getNVStr(B,'correctans',C.corrAns));C.bAnyAnswer=getNVInt(B,'anyanswer',this.bAnyAnswer);C.bCaseSensitive=getNVInt(B,'casesensitive',this.bCaseSensitive);C.separator=getNVStr(B,'separator',this.separator);C.corrFbTxt=unescape(getNVStr(B,'correctfbtext',''));C.incorrFbTxt=unescape(getNVStr(B,'incorrectfbtext',''));C.maxAllowedAttempts=getNVInt(B,'maxallowedattempts',0);D=D.replace(/\r\n/g,'<br>');D=D.replace(/\n/g,'<br>');D=D.replace(/\r/g,'<br>');C.text=D;if (C.type==7||C.type==6||C.type==2||C.type==9||C.type==14||C.type==11){var E=0;var F;F=C.corrAns.indexOf(',');while(F!=-1){C.arCorrAns.push(C.corrAns.substring(E,F));E=F+1;F=C.corrAns.indexOf(',',E);};C.arCorrAns.push(C.corrAns.substring(E,C.corrAns.length));};if (C.type==5){var E=0;var F=C.corrAns.indexOf('|');while (F!=-1){C.arCorrAns.push(C.corrAns.substring(E,F));E=F+1;F=C.corrAns.indexOf('|',E);};C.arCorrAns.push(C.corrAns.substring(E,C.corrAns.length));};if (C.type==13){var I=getNVStr(B,'relationship',I);var E=0;var F=I.indexOf('|');while (F!=-1){C.arRel.push(I.substring(E,F));E=F+1;F=I.indexOf('|',E);};C.arRel.push(I.substring(E,I.length));E=0;var L=C.separator.length;F=C.corrAns.indexOf(C.separator);while (F!=-1){C.arCorrAns.push(C.corrAns.substring(E,F));E=F+L;F=C.corrAns.indexOf(C.separator,E);};C.arCorrAns.push(C.corrAns.substring(E,C.corrAns.length));};C.choices=unescape(getNVStr(B,'choices',C.choices));C.choicefbs=unescape(getNVStr(B,'choicefbs',''));if (C.type==2||C.type==9||C.type==14||C.type==7||C.type==6||C.choices.indexOf('|')>=0){var E=0;var F=C.choices.indexOf('|');while (F!=-1){C.arChoices.push(C.choices.substring(E,F));E=F+1;F=C.choices.indexOf('|',E);};C.arChoices.push(C.choices.substring(E,C.choices.length));if (C.choicefbs){var O=C.choicefbs.split('~|~');for (var i=0;i<O.length;i++) C.arChoiceFBs.push(O[i]);}};var P=getNVStr(B,'addedinfo',null);if(P){var E=0;var F=P.indexOf('|');while (F!=-1){C.arAddedInfo.push(P.substring(E,F));E=F+1;F=P.indexOf('|',E);};C.arAddedInfo.push(P.substring(E,P.length));};var S=getNVStr(B,'statements',null);if(S){var E=0;var F=S.indexOf('|');while (F!=-1){C.arStatements.push(S.substring(E,F));E=F+1;F=S.indexOf('|',E);};C.arStatements.push(S.substring(E,S.length));};C.bAllowMult=getNVInt(B,'allowmult',C.bllowMult);C.bPersist=getNVInt(B,'persist',C.bPersist);C.bGradeInd=getNVInt(B,'gradeindividual',C.bGradeInd);C.bSurvey=getNVInt(B,'surveyquestion',C.bSurvey);};TQPr.getQCnt=function(){var A=this;var B=0;if(!A.bSurvey){if(A.bGradeInd){if (A.type==14||A.type==9) B=A.arChoices.length;else if(A.arCorrAns.length>0) B=this.arCorrAns.length;else{B=1;for(var C=A.corrAns.indexOf(',');C!=-1;C=A.corrAns.indexOf(',',C+1)) B++;}}else if(A.type!=-1) B=1;};return B;};TQPr.getMaxScore=function(){return this.getQCnt()*this.weight;};TQPr.getScore=function(){var A=0;if(!this.bSurvey){if(this.type!=-1) A=this.iOurScore;};return A;};TQPr.isScoreable=function(){if(!this.bSurvey){if(this.type==3||this.type==4){if(this.weight>0) return false;}};return true;};TQPr.isCorrect=function(){var A=this;if(!A.bSurvey){if(A.strOurAns==null||A.strOurAns.length==0) return 0;switch(A.type){case 1:if(A.strOurAns!=null&&A.strOurAns==A.corrAns) return 1;break;case 2:case 9:case 14:case 11:if(A.strOurAns!=null&&A.bGradeInd){var B,C;var D=0;for(var i=0;i<this.arChoices.length;i++){var E=this.arChoices[i].replace(/,/g,"&#44");if(this.type==11){var F={i:-1};B=A.isChoiceSelected(E,this.strOurAns,F);if(this.isCorrectSub(E,F)>0) C=true;else C=false;if((C&&B)) D++;}else{B=A.isChoiceSelected(E,this.strOurAns);if(this.isCorrectSub(E)>0) C=true;else C=false;if((C&&B)||(!C&&!B)) D++;}};return D;}else if(A.strOurAns!=null&&A.strOurAns==A.corrAns) return 1;break;case 3:case 4:return 0;case 5:var G;var H;var I=0;if (!A.bCaseSensitive) H=A.strOurAns.toString().toLowerCase();else H=this.strOurAns.toString();for (var i=0;i<A.arCorrAns.length;i++) {if (!A.bCaseSensitive) G=A.arCorrAns[i].toLowerCase();else G=A.arCorrAns[i];if (A.bAnyAnswer) { if (H==G) return 1;}else { if (H.indexOf(G)==-1) return 0;else I=1;}};return I;case 13:var H=parseFloat(A.strOurAns.replace(/,/g,''));var I=0;var y=0;for (var i=0;i<A.arRel.length;i++){var L=false;switch (parseInt(A.arRel[i])){case 1:L=(H==parseFloat(A.arCorrAns[y].replace(/,/g,'')));break;case 2:L=(H>=parseFloat(A.arCorrAns[y].replace(/,/g,''))&&H<=parseFloat(A.arCorrAns[y+1].replace(/,/g,'')));y++;break;case 3:L=(H>parseFloat(A.arCorrAns[y].replace(/,/g,''))&&H<parseFloat(A.arCorrAns[y+1].replace(/,/g,'')));y++;break;case 4:L=(H>parseFloat(A.arCorrAns[y].replace(/,/g,'')));break;case 5:L=(H>=parseFloat(A.arCorrAns[y].replace(/,/g,'')));break;case 6:L=(H<parseFloat(A.arCorrAns[y].replace(/,/g,'')));break;case 7:L=(H<=parseFloat(A.arCorrAns[y].replace(/,/g,'')));break;case 8:L=(H!=parseFloat(A.arCorrAns[y].replace(/,/g,'')));break;};y++;if ((A.bAnyAnswer&&L)||(!A.bAnyAnswer&&!L)) return L;I=L;};return I;case 6:var M=A.strOurAns+',';var N;var D=0;for(var i=0;i<A.arCorrAns.length;i++){N=A.arCorrAns[i]+',';if(M.indexOf(N)!=-1) D+=1;else{if(!A.bGradeInd) return 0;}};if(A.bGradeInd) return D;else return 1;break;case 7:var M=A.strOurAns+',';var N;var D=0;for(var i=0;i<A.arCorrAns.length;i++){N=A.arCorrAns[i];var S=N.split('|');var T=false;for(var j=0;j<S.length&&!T;j++){var U=S[j];if(M.indexOf(U)!=-1) T=true;};if(T) D+=1;else{if(!A.bGradeInd) return 0;}};if(A.bGradeInd) return D;else return 1;break;case 8:return 1;}};return 0;};TQPr.getMatchingPairStr=function (A,B){var C=",";var D=",";var E="";var F;var G;D+=B+",";C+=A+"-";F=D.indexOf(C);if(F<0) return E;G=D.indexOf(",",F+1);E=D.substring(F+1,G);return E;};TQPr.getAllMatchingPairStr=function (){var A=this;var B='';for(var C=0;C<A.arCorrAns.length;C++){var D=A.arCorrAns[C].substring(0,A.arCorrAns[C].indexOf('-'));var E=A.getMatchingPairStr(D,A.strOurAns);B+=(E==n||E.length==0?trivstrNA:E);if(C<A.arCorrAns.length-1) B+=",";};return B;};TQPr.isChoiceSelected=function (A,B,C){var D=B.split(',');var i;for(i=0;i<D.length;i++){if(D[i]==A) break;};if(C){if(i<D.length) C.i=i;else C.i=-1;};if(i>=D.length) return false;return true;};TQPr.isCorrectSub=function(A,B){if(!this.bSurvey){if(A!=null&&A.length>0){for(var i=0;i<this.arCorrAns.length;i++){if(A==this.arCorrAns[i]){if(B){B.correcti=i;if(B.i==i) return 1;else return 0;}else return 1;}}}};return 0;};TQPr.getNumTFQs=function(){if(!this.bSurvey){if(this.type==1) return this.weight;};return 0;};TQPr.getNumCorrectTFQs=function(){if(!this.bSurvey){if(this.type==1) return this.isCorrect()*this.weight;};return 0;};TQPr.getNumMCQs=function(){var A=0;if(!this.bSurvey){switch(this.type){case 2:case 5:case 9:case 13:case 14:case 7:case 6:A=1;if(this.bGradeInd) A=this.arChoices.length;break;};A*=this.weight;};return A;};TQPr.getNumCorrectMCQs=function(){var A=0;if(!this.bSurvey){switch(this.type){case 2:case 5:case 9:case 7:case 6:case 13:case 14:A=this.isCorrect();break;};A*=this.weight;};return A;};TQPr.gradeQs=function(A){var B=this;var C;B.strOurAns=null;B.iOurScore=0;if(B.type!=-1){for(C=0;C<A.length;C++){if(A[C].vn==B.varName){B.strOurAns=A[C].vv;break;}};if(!B.bSurvey){var D=B.isCorrect();var E=B.getParTest();E.iQuestCnt+=B.getQCnt();E.iCorrCnt+=D;B.iOurScore=D;B.iOurScore*=B.weight;}}};TQPr.isAnswered=function(){return this.strOurAns!=n&&this.strOurAns.length>0&&this.strOurAns!="~~~null~~~";};TQPr.getQuStatus=function(A){var B=this,C=f,D,E;switch(B.type){case 1:case 2:case 9:case 11:case 12:case 14:case 5:case 13:if (B.bGradeInd){D=B.arChoices[A].replace(/,/g,"&#44");if(B.type==11){var F={ i:-1,correcti:-1};B.isChoiceSelected(D,B.strOurAns,F);C=B.isCorrectSub(D,F)>0;}else{E=B.isChoiceSelected(D,B.strOurAns);C=B.isCorrectSub(D)>0?E:!E;}}else{C=B.isCorrect()>0;};break;case 10:case 3:case 4:C=t;break;case 7:case 6:if(B.bGradeInd){var G=t;for(var H=0,I=B.arCorrAns.length;H<I;H++){if(B.arCorrAns[H].indexOf(B.arChoices[A])>=0){G=f;var J=B.arCorrAns[H].substring(0,B.arCorrAns[H].indexOf('-'));var K=B.getMatchingPairStr(J,B.strOurAns);C=B.isCorrectSub(K)>0;break;}};if(G) C=!B.getMatchingPairStr(B.arChoices[A],B.strOurAns);}else{C=B.isCorrect()>0;};break;};return C;};TQPr.getAnsCho=function(){var A=this,B='';if ([5,13,3,4].indexOf(A.type)==-1){for (var i=0;i<A.arChoices.length;i++) B+='<li>'+A.arChoices[i]+'</li>';};return B;};TQPr.getStuAns=function(A,B){var C=this,D=trivstrNA,E;E=C.arChoices[A];E=E?E.replace(/,/g,"&#44"):'';switch (C.type){case 7:case 6:if(C.bGradeInd){var F=t;for(var G=0,H=C.arCorrAns.length;G<H;G++){if(C.arCorrAns[G].indexOf(C.arChoices[A])>=0){F=f;var I=C.arCorrAns[G].substring(0,C.arCorrAns[G].indexOf('-'));D=C.getMatchingPairStr(I,C.strOurAns)||'('+trivstrNOSEL+')';break;}};if(F) D=C.getMatchingPairStr(C.arChoices[A],C.strOurAns)||'('+trivstrNOSEL+')';}else if (C.isAnswered()) D=C.getAllMatchingPairStr();break;case 11:if(C.bGradeInd){var J={ i:-1,correcti:-1};var K=C.isChoiceSelected(E,C.strOurAns,J);if (K||C.isCorrectSub(E,J)>0) D=E+"-"+(J.i+1).toString();}else if (C.isAnswered()) D=C.strOurAns;break;default:if(C.bGradeInd) D=(C.isChoiceSelected(E,C.strOurAns)?'('+trivstrSEL+') ':'('+trivstrNOSEL+') ')+E;else if (C.isAnswered()) D=C.strOurAns;};return D;};TQPr.getCorAns=function(A,B){var C=this,D='';switch (C.type){case 5:D=C.corrAns.replace(/\|/g," "+(C.bAnyAnswer?trivstrOr:trivstrAnd)+" ");break;case 13:D=C.getNEResult();break;case 7:case 6:if(C.bGradeInd) D=C.arCorrAns[A]===undefined?'('+trivstrNOSEL+')':C.arCorrAns[A];else D=C.arCorrAns;break;case 11:if (C.bGradeInd) D=C.arCorrAns[A]+'-'+(A+1);else D=C.corrAns;break;case 10:case 3:case 4:break;default:if (C.bGradeInd){var E=f;var F=C.arChoices[A];for (var i=0;i<C.arCorrAns.length;i++){if (F==C.arCorrAns[i]) E=t;};D=(E?'('+trivstrSEL+') ':'('+trivstrNOSEL+') ')+F;}else D=C.corrAns;};return D;};TQPr.getTxtFb=function(){var A=n;if (this.arChoiceFBs.length){var B=triv$.inArray(this.strOurAns,this.arChoices);if (B!=-1) A=this.arChoiceFBs[B];}else A=this.isCorrect()?this.corrFbTxt:this.incorrFbTxt;return A;};TQPr.getAttNum=function(){return '<<< # of attempts place holder >>>';};TQPr.getAttMax=function(){return this.maxAllowedAttempts?'~Max attempts~ : '+this.maxAllowedAttempts:'';};TQPr.getLnkQu=function(A){return '<a href="javascript:navtoPage(\''+this.par.name+'\','+this.par.id+');">'+trivstrLKP+' '+A+'</a>';};TQPr.getLnkFst=function(){var A=this.getLoadedTest().arRTPages[0];return '<a href="javascript:navtoPage(\''+A.name+'\','+A.id+');">'+trivstrLKF+'</a>';};TQPr.createTextResults=function(A,B,C){var D=this,E=D.getLoadedTest(),F,G,H,I,J,K,L,M,E=D.getLoadedTest();var O=function (W){return  W.charAt(W.length-1)==" "?W:W+=" ";};var P=function(X,Y,Z,a){var b='style="'+(a?a:''),c=Y?Y.font:n;c=c||E.defaultFont;b+='margin:'+(c&&c.size?Math.round(c.size/2):8)+'px 0px;';if (c){if (c.name) 		b+='font-family:'+c.name+';';if (c.size) 		b+='font-size:'+c.size+'pt;';if (c.bold) 		b+='font-weight:bold;';if (c.italic) 		b+='font-style:italic;';if (c.underline) 	b+='text-decoration:underline;';if (c.color)	 	b+='color:'+c.color+';';};b+='"';Z=Z?Z:'p';A.add('<'+Z+' '+(b?b:'')+'>'+X+'</'+Z+'>');};var Q=function(d){if (d&&d.res){var e=d.res.size,f='',g;if (e) f=' width="'+e.x+'" height ="'+e.y+'"';g=(typeof d.res.getLink=='function')?d.res.getLink():d.res.linkName;A.add('<img style="margin:5px 0px;" src="'+g+'"'+f+'>');}};if(D.type!=-1){B++;var R=(D.type==3||D.type==4||D.type==10);K=D.bGradeInd?D.arChoices.length:1;L=t;for (var S=0;S<K;S++){G=D.getQuStatus(S,C);H=!D.isAnswered();F=D.getRsltSettings(E,G,S==0,G,H);I=H?trivstrNA:G?trivstrCOR:trivstrINC;M=f;if ((E.dwTRFlags&0x1&&G)||(E.dwTRFlags&0x2&&!G)||(E.dwTRFlags&0x4&&H)) M=t;if (!M) continue;trivArExec(F.arRsltItems,function(h){switch(h.id){case 101:qNumStr=B+(D.bGradeInd&&!L?'.'+(S+1):'');P(trivstrQ+qNumStr,h);L=f;break;case 102:if (S==0) P(D.text,h);break;case 103:P(O(trivstrYA)+D.getStuAns(S,C),h);break;case 104:J=D.getCorAns(S,C);if (J) P(O(trivstrCA)+D.getCorAns(S,C),h);break;case 105:P(D.getLnkQu(B),h);break;case 106:P(D.name,h);break;case 107:if (!R) P(I,h);break;case 12:if (!R) Q(h);break;case 109:if (D.type==1||D.type==2||D.type==14) P(D.getAnsCho(),h,'ul','padding: 0px 30px;');break;case 110:var T=D.getTxtFb();if (T) P(O(trivstrFBTR)+T,h);break;case 111:P(D.getAttNum(),h);break;case 112:var U=D.getAttMax();if (U) P(U,h);break;case 113:P(D.getLnkFst(),h);break;case 114:A.add('<hr style="border: '+E.horRuleWeight+'px solid '+E.horRuleColor+';">');break;case 115:A.add('<hr style="border: 1px dashed '+E.horRuleColor+';">');break;}});}};return B;};TQPr.getRsltSettings=function(A,B,C,B,E){var F=[],G=[],H=[],I,J=TrivQuestion.arGrIndMasterItems;var K=function(L,M){for (var i=0;i<L.length;i++) if (L[i]==M) return t;return f;};if (this.bGradeInd){if (C){if (A.bHorRule) F.push({ 'id':114 });trivArExec (A.settingsQCorr.arRsltItems,function (N){if (K (J,N.id)){F.push(N);G.push(N.id);}});trivArExec (A.settingsQIncorr.arRsltItems,function (O){if (!K (G,O.id)&&K (J,O.id)){F.push(O);G.push(O.id);}});}else if (A.bHorRule) F.push({ 'id':115 });H=B?A.settingsQCorr:A.settingsQIncorr;trivArExec (H.arRsltItems,function (P){if (!K (J,P.id)||P.id==101) F.push(P);});}else{if (A.bHorRule) F.push({ 'id':114 });I=E?A.settingsQUnans:B?A.settingsQCorr:A.settingsQIncorr;trivArExec(I.arRsltItems,function (Q) { F.push(Q);});};I={ 'arRsltItems':F };return I;};TQPr.createTextResultsOLD=function(A,B,C){};TQPr.createCGIResults=function(A,B,C,D){var E=this,F,G,H,I="",J="",K="",L="",M="",N="",O="",P="",Q;if(C==undefined) C=false;if(D==undefined) D=false;B++;Q=B;I="Question"+Q;J="Answer"+Q;K="CorrectAnswer"+Q;L="QuestionType"+Q;M="QuestionID"+Q;N="Section"+Q;if(!C) A.addparm(L,E.type);if(!C) A.addparm(M,E.id);if(this.iSectionId>0&&!C) A.addparm(N,E.iSectionId);switch(E.type){case 1:case 2:case 9:case 11:case 12:case 14:if(!C) A.addparm(I,E.text);if(E.bGradeInd){for(F=0;F<E.arChoices.length;F++){if(E.strOurAns==null||E.strOurAns.length==0||E.strOurAns=="~~~null~~~") H=trivstrNA;else{if(E.isChoiceSelected(E.arChoices[F],E.strOurAns)) H=E.arChoices[F];else H=trivstrNA+', '+E.arChoices[F];};if(C) if (D) A.addparm('entry_1'+padDigits(A.getCount(),6),H);else A.addparm('entry.'+A.getCount()+'.single',H);else A.addparm(J,H);if(!C) A.addparm(K,E.corrAns);if(F<E.arChoices.length-1){B++;Q=B;I="Q"+Q;J="Answer"+Q;K="CorrectAnswer"+Q;L="QuestionType"+Q;M="QuestionID"+Q;N="Section"+Q;if(!C) A.addparm(I,E.text);if(!C) A.addparm(L,E.type);if(!C) A.addparm(M,E.id);if(E.iSectionId>0&&!C) A.addparm(N,E.iSectionId);}}}else{if(E.strOurAns==null||E.strOurAns.length==0||E.strOurAns=="~~~null~~~") H=trivstrNA;else H=E.strOurAns;if(C) if (D) A.addparm('entry_1'+padDigits(A.getCount(),6),H);else A.addparm('entry.'+A.getCount()+'.single',H);else A.addparm(J,H);if(!E.bSurvey&&!C) A.addparm(K,E.corrAns);};break;case 10:if(E.strOurAns==null||E.strOurAns.length==0||E.strOurAns=="~~~null~~~") H=trivstrNA;else H=E.strOurAns;var R=0;for(var i=0;i<E.arAddedInfo.length;i++){for(var j=0;j<E.arChoices.length;j++){var S=E.arAddedInfo[i]+'-'+E.arChoices[j];if (H.indexOf(S)>-1){if (R>0){B++;Q=B;I="Question"+Q;J="Answer"+Q;L="QuestionType"+Q;M="QuestionID"+Q;N="Section"+Q;if(!C) A.addparm(L,E.type);if(!C) A.addparm(M,E.id);if(this.iSectionId>0&&!C) A.addparm(N,E.iSectionId);};O="Instructions"+Q;P="QuestionName"+Q;if(!C) A.addparm(O,E.text);if(!C) A.addparm(P,E.arAddedInfo[i]);if(!C) A.addparm(I,E.arStatements[i]);if(C) if (D) A.addparm('entry_1'+padDigits(A.getCount(),6),E.arChoices[j]);else A.addparm('entry.'+A.getCount()+'.single',E.arChoices[j]);else A.addparm(J,E.arChoices[j]);R++;}};if(!C) A.addparm("AnswerAll"+Q,H);};break;case 5:case 13:if(!C) A.addparm(I,E.text);if(E.strOurAns==null||E.strOurAns.length==0||E.strOurAns=="~~~null~~~") H=trivstrNA;else H=E.strOurAns;if(C) if (D) A.addparm('entry_1'+padDigits(A.getCount(),6),H);else A.addparm('entry.'+A.getCount()+'.single',H);else A.addparm(J,H);if(!E.bSurvey&&!C){G=E.corrAns.indexOf('|');if(G>=0) H=E.corrAns.substring(0,G);else H=E.corrAns;A.addparm(K,H);};break;case 4:case 3:if(!C) A.addparm(I,E.text);if(E.strOurAns==null||E.strOurAns.length==0||E.strOurAns=="~~~null~~~") H=trivstrNA;else H=E.strOurAns;if(C) if (D) A.addparm('entry_1'+padDigits(A.getCount(),6),H);else A.addparm('entry.'+A.getCount()+'.single',H);else A.addparm(J,H);break;case 7:case 6:if(!C) A.addparm(I,E.text);var T;if(E.bGradeInd){for(F=0;F<E.arCorrAns.length;F++){T=E.arCorrAns[F].substring(0,E.arCorrAns[F].indexOf('-'));H=E.getMatchingPairStr(T,E.strOurAns);if(H==null||H.length==0) H=trivstrNA;A.addparm(J,H);if(!C) A.addparm(K,E.arCorrAns[F]);if(F<E.arCorrAns.length-1){B++;Q=B;I="Q"+Q;J="Answer"+Q;K="CorrectAnswer"+Q;L="QuestionType"+Q;M="QuestionID"+Q;N="Section"+Q;if(!C) A.addparm(I,E.text);if(!C) A.addparm(L,E.type);if(!C) A.addparm(M,E.id);if(E.iSectionId>0&&!C) A.addparm(N,E.iSectionId);}}}else{if(E.strOurAns==null||E.strOurAns.length==0||E.strOurAns=="~~~null~~~") H=trivstrNA;else{var U;H="";if (E.arCorrAns.length===1&&!E.arCorrAns[0]&&E.arCorrAns[0]!==0) H=E.strOurAns;else for(F=0;F<E.arCorrAns.length;F++){T=E.arCorrAns[F].substring(0,E.arCorrAns[F].indexOf('-'));U=E.getMatchingPairStr(T,E.strOurAns);if(U==null||U.length==0) H+=trivstrNA;else H+=U;if(F<E.arCorrAns.length-1) H+=",";}};if(C) A.addparm(D?('entry_1'+padDigits(A.getCount(),6)):('entry.'+A.getCount()+'.single'),H);else{A.addparm(J,H);A.addparm(K,E.corrAns);}};break;};return B;};TQPr.getNEResult=function () {var A=this;var B="";var y=0;for (var i=0;i<A.arRel.length;i++) {var C=" "+A.separator+" ";if (i==0) C="";switch (parseInt(A.arRel[i])) {case 1:B+=C+"= "+A.arCorrAns[y];break;case 2:B+=C+"( >= "+A.arCorrAns[y]+" "+trivstrAnd+" <= "+A.arCorrAns[y+1]+" )";y++;break;case 3:B+=C+"( > "+A.arCorrAns[y]+" "+trivstrAnd+" < "+A.arCorrAns[y+1]+" )";y++;break;case 4:B+=C+"> "+A.arCorrAns[y];break;case 5:B+=C+">= "+A.arCorrAns[y];break;case 6:B+=C+"< "+A.arCorrAns[y];break;case 7:B+=C+"<= "+A.arCorrAns[y];break;case 8:B+=C+"!= "+A.arCorrAns[y];break;};y++;};return B;};TQPr.getParTest=function (){var A=this;while (A){if (A instanceof TrivTest) return A;A=A.par;};return n;};
